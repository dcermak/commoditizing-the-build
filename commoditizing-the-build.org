# -*- org-confirm-babel-evaluate: nil; -*-
#+AUTHOR: Dan ÄŒermÃ¡k
#+DATE: February 1, 2026
#+EMAIL: dan.cermak@posteo.net
#+TITLE: Commoditizing the Build
#+SUBTITLE: How Containers Save Our Contributor Base

#+REVEAL_ROOT: ./node_modules/reveal.js/
#+REVEAL_THEME: simple
#+REVEAL_PLUGINS: (highlight notes history)
#+OPTIONS: toc:nil
#+REVEAL_DEFAULT_FRAG_STYLE: appear
#+REVEAL_INIT_OPTIONS: transition: 'none', hash: true
#+OPTIONS: num:nil toc:nil center:nil reveal_title_slide:nil
#+REVEAL_EXTRA_CSS: ./node_modules/@fortawesome/fontawesome-free/css/all.min.css
#+REVEAL_EXTRA_CSS: ./custom-style.css
#+REVEAL_HIGHLIGHT_CSS: ./node_modules/reveal.js/plugin/highlight/zenburn.css
#+REVEAL_EXTRA_SCRIPT_SRC: ./node_modules/highlightjs-rpm-specfile/rpm-specfile.js

#+REVEAL_TITLE_SLIDE: <h2 class="title">%t</h2>
#+REVEAL_TITLE_SLIDE: <p class="subtitle" style="color: Gray;">%s</p>
#+REVEAL_TITLE_SLIDE: <p class="author">%a</p>
#+REVEAL_TITLE_SLIDE: <div style="float:left"><a href="https://fosdem.org/2026/" target="_blank"><img src="./media/FOSDEM_logo.svg" height="50px" style="margin-bottom:-12px"/> FOSDEM 2026</a></div>
#+REVEAL_TITLE_SLIDE: <div style="float:right;font-size:35px;"><p xmlns:dct="http://purl.org/dc/terms/" xmlns:cc="http://creativecommons.org/ns#"><a href="https://creativecommons.org/licenses/by/4.0" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">
#+REVEAL_TITLE_SLIDE: CC BY 4.0 <i class="fab fa-creative-commons"></i> <i class="fab fa-creative-commons-by"></i></a></p></div>

@@html: <script type="text/javascript">hljs.registerLanguage('rpm-specfile', window.hljsDefineRpmSpecfile); hljs.initHighlightingOnLoad(); </script>@@


* who -u

Dan ÄŒermÃ¡k

@@html: <div style="float:center">@@
@@html: <table class="who-table">@@
@@html: <tr><td><i class="fab fa-suse"></i></td><td> Fullstack Developer @SUSE</td></tr>@@
@@html: <tr><td><i class="fab fa-fedora"></i></td><td> i3 SIG, Package maintainer</td></tr>@@
@@html: <tr><td><i class="far fa-heart"></i></td><td> Developer Tools, Testing and Documentation, Home Automation</td></tr>@@
@@html: <tr></tr>@@
@@html: <tr></tr>@@
@@html: <tr><td><i class="fa-solid fa-globe"></i></td><td> <a href="https://dancermak.name/">https://dancermak.name</a></td></tr>@@
@@html: <tr><td><i class="fab fa-github"></i></td><td> <a href="https://github.com/dcermak/">dcermak</a></td></tr>@@
@@html: <tr><td><i class="fab fa-mastodon"></i></td><td> <a href="https://mastodon.social/@Defolos">@Defolos@mastodon.social</a></td></tr>@@
@@html: <tr><td><i class="fab fa-bluesky"></i></td><td> <a href="https://bsky.app/profile/defolos.bsky.social">@defolos.bsky.social</a></td></tr>@@
@@html: </table>@@
@@html: </div>@@


* outline


* Where are we?

#+begin_notes
- our contributor base is aging, look around (ML, chat, etc), it's the same people, just getting older
- so how does our developer cohort look like: let's start with stackoverflow dev
#+end_notes

# source: https://web.archive.org/web/20250222084312/https://blog.tidelift.com/the-open-source-maintainer-community-is-getting-grayer
#+ATTR_REVEAL: :frag (appear)
@@html:<img src="./media/Tidelift 2024 charts wlogo Fig 12-1.png" height="500px"/>@@

#+REVEAL: split

@@html:<img src="./media/stackoverflow_distribution.svg" height="500px"/>@@

#+REVEAL: split

@@html:<img src="./media/linux_foundation_distribution.svg" height="500px"/>@@

#+REVEAL: split

@@html:<img src="./media/debian_distribution.svg" height="500px"/>@@

#+REVEAL: split

@@html:<img src="./media/opensuse_distribution.svg" height="500px"/>@@

#+REVEAL: split

@@html:<img src="./media/cncf_distribution.svg" height="500px"/>@@

** What do Developers want?

#+begin_notes
- stackoverflow 2025 survey, cloud development, AI and Web Dev are the focus
- giant shift towards docker & kubernetes: https://survey.stackoverflow.co/2025/technology/#3-cloud-development
- big shift towards github:
  https://survey.stackoverflow.co/2025/technology/#3-community-platforms and
  https://survey.stackoverflow.co/2025/technology/#3-code-documentation-and-collaboration-tools
- lots of movement towards Go, Rust, Typescript:
  https://survey.stackoverflow.co/2025/technology/#3-programming-scripting-and-markup-languages
#+end_notes

#+ATTR_REVEAL: :frag (appear)
@@html:<img src="media/stackoverflow-dev-survey-2025-technology-admired-and-desired-platform-desire-admire-social.png"/>@@

#+ATTR_REVEAL: :frag (appear)
@@html:<img src="media/stackoverflow-dev-survey-2025-technology-admired-and-desired-office-stack-async-desire-admire-social.png"/>@@

** Why don't they want us?

#+ATTR_REVEAL: :frag (appear)
- our tooling & platforms aren't cool anymore
- our values aren't cool anymore
- ðŸ¤– LLMs are not trained on our tooling
- building a distribution is hardâ„¢ and solved

#+ATTR_REVEAL: :frag (appear)
@@html:<img src="./media/linux-distro-build-pipeline.svg"/>@@

#+REVEAL: split

#+ATTR_REVEAL: :frag (appear)
@@html:<img src="./media/from-source-to-image.svg"/>@@

* Omarchy

#+begin_notes
- very popular Linux spin based on Arch
- super opinionated Hyprland setup
- mostly shell scripts
\rightarrow too simple for a general purpose distribution
#+end_notes

#+ATTR_REVEAL: :frag (appear)
- Opinionated Arch Linux spin with Hyprland
- Community on @@html:<i class="fa-brands fa-github"></i>@@ Github & @@html:<i class="fa-brands fa-discord"></i>@@ Discord

#+ATTR_REVEAL: :frag (appear)
@@html:<img src="./media/omarchy-github-languages.png"/>@@

* Universal Blue

@@html:<img src="./media/ublue.svg" />@@

#+ATTR_REVEAL: :frag (appear) :frag_idx 0
#+begin_quote
This is a tool that allows cloud infrastructure people to use their skills to help the Linux desktop
#+end_quote
#+ATTR_REVEAL: :frag (appear) :frag_idx 0
uBlue - [[https://universal-blue.org/#who][Who We Are]]

** Stack

#+ATTR_REVEAL: :frag (appear)
- [[https://bootc-dev.github.io/bootc/][bootc]] + ~Dockerfile~
- @@html:<i class="fa-brands fa-github"></i>@@ Github & Github Actions

#+ATTR_REVEAL: :frag (appear)
Community on:
#+ATTR_REVEAL: :frag (appear)
- @@html:<i class="fa-brands fa-discord"></i>@@ Discord
- @@html:<i class="fa-brands fa-discourse"></i>@@ Discourse

** TODO Contributors

#+ATTR_REVEAL: :frag (appear)
@@html:<img src="./media/ublue-contributors-2024.png"/>@@


* Take Away

Developers like:
#+ATTR_REVEAL: :frag (appear)
- @@html:<i class="fa-brands fa-github"></i>@@ Github
- @@html:<i class="fa-brands fa-discord"></i>@@ Discord
- opinionated distributions
- their tooling (Bash + Docker @@html:<i class="fa-brands fa-docker"></i>@@)

#+ATTR_REVEAL: :frag (appear)
=> Let's use more container tooling

** The Build Recipe

#+ATTR_REVEAL: :frag (appear) :code_attribs data-line-numbers='|1-4|5-9|11-13|15-19|21-23|25-28|30-31|33-37|39-51|53-54|'
#+begin_src spec
Summary:	Extensible editor for structured binary data
Name:		poke
Version:	4.3
Release:	%autorelease

License:	GPL-3.0-or-later AND GFDL-1.3-no-invariants-or-later
URL:		https://www.jemarch.net/poke
Source0:	https://ftp.gnu.org/gnu/%{name}/%{name}-%{version}.tar.gz
Source1:	https://ftp.gnu.org/gnu/%{name}/%{name}-%{version}.tar.gz.sig

BuildRequires:	emacs
BuildRequires:	gcc
BuildRequires:	gc-devel

%description
GNU poke is an interactive, extensible editor for binary data. Not
limited to editing basic entities such as bits and bytes, it provides
a full-fledged procedural, interactive programming language designed
to describe data structures and to operate on them.

%prep
%{gpgverify} --keyring='%{SOURCE2}' --signature='%{SOURCE1}' --data='%{SOURCE0}'
%autosetup

%build
%define _lto_cflags %{nil}
%configure
%make_build

%check
make check

%install
%{make_install}
rm -f %{buildroot}/%{_infodir}/dir
rm -f %{buildroot}%{_libdir}/libpoke.a
rm -f %{buildroot}%{_libdir}/libpoke.la

%files
%{_bindir}/%{name}
%{_bindir}/poked
%{_bindir}/pokefmt
%{_bindir}/pk-bin2poke
%{_bindir}/pk-jojopatch
%{_bindir}/pk-strings
%{_infodir}/poke.info*.*
%{_mandir}/man1/%{name}.1*
%{_mandir}/man1/poked.1*
%{_mandir}/man1/pokefmt.1*
%doc AUTHORS ChangeLog NEWS README TODO
%license COPYING

%changelog
%autochangelog
#+end_src

** Is it that much different to this?

#+ATTR_REVEAL: :frag (appear) :code_attribs data-line-numbers='|1-3|5-7|9|11-17|19|21|23-27|29'
#+begin_src Dockerfile
ARG VERSION=4.3
ARG DIST
FROM fedora-rpm-buildroot:${DIST} as buildrequires

WORKDIR /src/
COPY poke-${VERSION}.tar.gz .
COPY poke-${VERSION}.tar.gz.sig .

RUN dnf -y install emacs gcc gc-devel nbdkit make

FROM localhost/poke-buildrequires as builder

RUN rpmdev-extract poke-${VERSION}.tar.gz
WORKDIR /src/poke-${VERSION}
RUN ./configure; \
    make build; \
    make check

RUN make install PREFIX=/usr/local

FROM fedora-rpm-buildroot:${DIST} as poke

LABEL org.opencontainers.image.version=${VERSION}
LABEL org.opencontainers.image.url="https://www.jemarch.net/poke"
LABEL org.opencontainers.image.title="Extensible editor for structured binary data"
LABEL org.opencontainers.image.description="GNU poke is an interactive, extensible editor for binary data."
LABEL org.opencontainers.image.licenses="GPL-3.0-or-later AND GFDL-1.3-no-invariants-or-later"

COPY --from=builder /usr/local/bin /usr/bin
#+end_src

** Introducing: @@html:<i class="fa-brands fa-github"></i>@@ [[https://github.com/dcermak/roci][=dcermak/roci=]]

#+begin_notes
most pressing problems:
- network isolation, actually kinda easy to solve, via multistage builds
- AutoReqProv: rpm's dependency/provides generators. Absolutely required if you don't want packaging to suck. Solved by running =rpmdeps=
-
#+end_notes

#+ATTR_REVEAL: :frag (appear)
opinionated tool to build rpms from a =Dockerfile=

#+ATTR_REVEAL: :frag (appear)
- sections \Rightarrow stages
- =%files= \Rightarrow =COPY --from=builder=
- macros \Rightarrow build arguments, scripts, ENV variables
- Preamble \Rightarrow =LABEL= + config file
- =mock= / =obs-build= \Rightarrow =buildah=

** Issues to tackle

#+begin_notes
- reproducible builds: kinda important, should be mostly doable by setting =SOURCE_DATE_EPOCH= ðŸ¤ž
- macros: huge issue, rpm has
#+end_notes

#+ATTR_REVEAL: :frag (appear)
- dependency generation (=AutoReqProv=)
- reproducible builds
- debuginfo
- changelogs
- macros
- file lists

#+REVEAL: split

@@html:<img src="./media/roci-build.svg"/>@@

** Let's talk about macros

#+ATTR_REVEAL: :frag (appear)
- Turing complete m4 & cpp inspired language
- embedded Lua interpreter & shell expansion
- recursive text expansion

#+ATTR_REVEAL: :frag (appear)
Typical usage:
#+ATTR_REVEAL: :frag (appear)
- variables: =%build_cflags=
- conditionals: =%if %cond %endif=
- "functions": =%pytest=
- sections: =%prep=

#+ATTR_REVEAL: :frag (appear)
Maybe we should get rid of them?

** Filelists

#+begin_src spec
%files -f my-list.txt
%{_bindir}/%{name}
%config %{_sysconfdir}/%{name}.defaults
%config(noreplace) %{_sysconfdir}/%{name}
%doc README
%license COPYING
#+end_src

** COMMENT What do we gain

#+ATTR_REVEAL: :frag (appear)
- simplicity
- builds easier to debug & inspect

** What's a package?

#+ATTR_REVEAL: :frag (appear)
@@html:<img src="./media/rpm-package.svg"/>@@

** What's a OCI Image?

#+ATTR_REVEAL: :frag (appear)
@@html:<img src="./media/oci-image.svg"/>@@


** RPM + OCI

#+ATTR_REVEAL: :frag (appear)
@@html:<img src="./media/roci-build-to-oci.svg"/>@@


# stolen from https://specs.opencontainers.org/image-spec/manifest/ and modified
#+ATTR_REVEAL: :frag (appear) :code_attribs data-line-numbers='|3-4|5-9|10-16|17-21|'
#+begin_src json
{
  "schemaVersion": 2,
  "mediaType": "application/vnd.oci.image.manifest.v1+json",
  "artifactType": "application/vnd.rpm.package.v7",
  "config": {
    "mediaType": "application/vnd.rpm.package.header.v1+json",
    "digest": "sha256:b5b2b2c507a0944348e0303114d8d93aaaa081732b86451d9bce1f432a537bc7",
    "size": 7023
  },
  "layers": [
    {
      "mediaType": "application/vnd.oci.image.layer.v1.tar+gzip",
      "digest": "sha256:9834876dcfb05cb167a5c24953eba58c4ac89b1adf57f28f2f9d09af107ee8f0",
      "size": 32654
    }
  ],
  "subject": {
    "mediaType": "application/vnd.oci.image.manifest.v1+json",
    "digest": "sha256:5b0bcabd1ed22e9fb1310cf6c2dec7cdef19f0ad69efa1f392e94a4333501270",
    "size": 7682
  }
}
#+end_src


* Repositories

#+ATTR_REVEAL: :frag (appear)


* Questions?

#+ATTR_REVEAL: :frag (appear)
Answers!
